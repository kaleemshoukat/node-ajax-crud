<%- contentFor('title') %>
Posts
<%- contentFor('body') %>
<div class="col-md-12 card mt-5 bg-light">
    <div class="card-title">Search</div>
    <div class="card-body">
        <form action="javascript:void(0)">
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" name="title" id="title" class="form-control">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" name="description" id="description" class="form-control">
                    </div>
                </div>
                <div class="col-md-4">
                   <button id="submit_btn" class="btn btn-success">Search</button>
                </div>
            </div>
        </form>
    </div>
</div>
<div class="col-md-12 table-responsive mt-5">
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>#</th>
                <th>Titel</th>
                <th>Description</th>
                <th>Created At</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="append_list">

        </tbody>
    </table>

    <%- include('./partials/pagination.ejs') %>

</div>
<script>
    var monthShortNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    window.onload = pageloading(0);

    var title='';
    var description='';

    $('#submit_btn').on('click', function () {
        title=$('#title').val();
        description=$('#description').val();
        pageloading(0);
    });

    function pageloading(page) {
        $('#example-2').pagination({
            total: 1, // 总数据条数
            current: 1, // 当前页码
            length: 1, // 每页数据量
            size: 1, // 显示按钮个数
            prev: 'Previous',
            next: 'Next',
            ajax: function (options, refresh, $target) {
                $.ajax({
                    type: "post",
                    url: '/get-posts',
                    data: {
                        '_csrf' : $('meta[name="_csrf"]').attr('content'),
                        'page_num': options.current,
                        'title' : title,
                        'description' : description,
                    },
                    success: function (response) {
                        var html = '';

                        $.each(response.data.results, function (i, item) {
                            var d = new Date(item.createdAt);
                            var status_date = d.getDate() + "-" + monthShortNames[d.getMonth()] + "-" + d.getFullYear();

                            html+='<tr>' +
                                '<td>' + response.data.count + '</td>' +
                                '<td>' + item.title + '</td>' +
                                '<td>' + item.description + '</td>' +
                                '<td>' + status_date + '</td>' +
                                '<td>' +
                                '<a href="/edit-post/'+item._id+'" class="btn btn-success btn-sm">Edit</a>'+
                                '<a href="javascript:void(0)" class="btn btn-danger btn-sm delete_post" data-id="'+item._id+'">Delete</a>' +
                                '</td>' +
                                '</tr>';
                            ++ response.data.count;
                        });
                        if (html == "") {
                            html += '<tr class="text-center">' +
                                '<td colspan="5">No Data</td>' +
                                '</tr>';
                        }

                        $('#append_list').html('');
                        $('#append_list').append(html);

                        refresh({
                            total: response.data.total, // 可选
                            length: 10, // 可选
                        });
                    },
                    error: function () {
                        var html = '';
                        html += '<tr class="text-center">' +
                            '<td colspan="5">No Data</td>' +
                            '</tr>';
                        $('#append_list').html('');
                        $('#append_list').append(html);
                    }
                });
            }
        });
    }


</script>